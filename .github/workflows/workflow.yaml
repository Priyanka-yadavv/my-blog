name: Continuous Integration
env:
  MYSQL_DATABASE: "prdetails"
  MYSQL_USER: "dev"
  MYSQL_PASSWORD: "Priyanka#123"
  MYSQL_HOST: mysql-master
  NODE_ENV: test
on: push
jobs:
  run_code_checks:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v2
      - name: Setup go
        uses: actions/setup-go@v2
        with:
          go-version: 1.19
      - name: Run linting
        run: |
          go fmt ./...
          go vet ./...
      - name: Run tests
        services:
          mysql-master:
            image: mysql:5.7
            ports:
              - 3306/tcp
            env:
              MYSQL_DATABASE: ${{ env.MYSQL_DATABASE }}
              MYSQL_USER: ${{ env.MYSQL_USER }}
              MYSQL_PASSWORD: ${{ env.MYSQL_PASSWORD }}
              MYSQL_ROOT_PASSWORD: ${{ env.MYSQL_PASSWORD }}
            options: >-
              --name=mysql-master
              --health-cmd="mysqladmin ping"
              --health-interval=10s
              --health-timeout=5s
              --health-retries=3
        run: go test